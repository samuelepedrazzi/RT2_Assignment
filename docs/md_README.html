<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Assignment 3 - &lt;a href=&quot;https://unige.it/en/off.f/2021/ins/51201.html?codcla=10635&quot;&gt;Research_Track_1&lt;/a&gt; , &lt;a href=&quot;https://courses.unige.it/10635&quot;&gt;Robotics Engineering&lt;/a&gt;.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Assignment 3 - <a href="https://unige.it/en/off.f/2021/ins/51201.html?codcla=10635">Research_Track_1</a> , <a href="https://courses.unige.it/10635">Robotics Engineering</a>. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Robot simulator using ROS, Rviz and Gazebo.</h1>
<hr  />
<h2><a class="anchor" id="autotoc_md3"></a>
Introduction &lt;img src= "https://media2.giphy.com/media/fLsd17IO7HTCR85bDY/giphy.gif?cid=ecf05e47y9qetlendf7s1str4q1hzuzdr4ykg086vprnnccc&amp;rid=giphy.gif&amp;ct=s" width=100 height=60&gt;</h2>
<p>&gt;This is a Gazebo and Rviz-based ROS Robotics Simulator. The goal of this project is to build three mobility modes that the user could choose from to allow the robot to explore an unknown but constrained territory inside the simulation. On a user-interface terminal window, the user can pick the robot's desired behavior; the modalities include:</p>
<ul>
<li><b>1 - Autonomous Drive</b>: The user can select a goal position for the robot, and it will reach there on its own.</li>
<li><b>2 - Free Drive</b>: The user can use the keyboard to drive the robot in the environment.</li>
<li><b>3 - Driver Assistant</b>: The operator can direct the robot's movement with the keyboard, but an collision avoidance algorithm will keep the robot from crashing with walls.</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
Installing and Running &lt;img src="https://media0.giphy.com/media/XqYKfpjBL2bjUcWVQD/200w.webp?cid=ecf05e47f0avfktds1q4ksjx91r0uw1m2unss4u1btdrzy12&amp;rid=200w.webp&amp;ct=s" width="50"&gt;&lt;/h2&gt;</h2>
<p>This simulator is built on the <a href="http://wiki.ros.org"><b>ROS</b></a> (<b>Robot-Operating-Systems</b>) platform, specifically the NOETIC version.</p>
<p>For the specific project the program requires the installation of the following packages and tools before it can begin:</p>
<ul>
<li><a href="https://github.com/CarmineD8/slam_gmapping">Slam Gmapping package</a></li>
</ul>
<p>which can be installed with the bash command:</p>
<div class="fragment"><div class="line">$ git clone https://github.com/CarmineD8/slam_gmapping.git</div>
</div><!-- fragment --><ul>
<li>xterm</li>
</ul>
<p>Easy to install with:</p>
<div class="fragment"><div class="line">$ sudo apt-get install -y xterm</div>
</div><!-- fragment --><ul>
<li>Ros navigation stack</li>
</ul>
<p>To Install it:</p>
<div class="fragment"><div class="line">$ sudo apt-get install ros-&lt;ros_distro&gt;-navigation</div>
</div><!-- fragment --><p>Before running the simulation, first you have to run ROS (using <code>$ roscore &amp;</code> and <code>$ catkin_make</code> ), then the simulation begins when the user has all of the required packages and runs a .launch file called:</p>
<p><b>Assignment3_RT1.launch</b></p>
<div class="fragment"><div class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</div>
<div class="line"> </div>
<div class="line">&lt;launch&gt;</div>
<div class="line">  &lt;include file=&quot;$(find Assignment3_RT1)/launch/simulation_gmapping.launch&quot;/&gt;</div>
<div class="line">  &lt;include file=&quot;$(find Assignment3_RT1)/launch/move_base.launch&quot;/&gt;</div>
<div class="line"> </div>
<div class="line"> &lt;!-- Run the UI node --&gt;</div>
<div class="line">  &lt;node pkg=&quot;Assignment3_RT1&quot; type=&quot;UI&quot; respawn=&quot;false&quot; name=&quot;UI&quot; output=&quot;screen&quot; launch-prefix=&quot;xterm -e&quot; required=&quot;true&quot;/&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/launch&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Environment and mapping</h2>
<p>Rviz (a 3D visualizer for the Robot Operating System (ROS) framework) and Gazebo (an open-source 3D Robotics simulator) appear on the screen as soon as the simulator starts: Thanks to its sensors, the robot can see what's going on in the world around it.</p>
<p>ROS creates the environment described in the <b>world</b> folder's file <code>house.world.</code></p>
<p>The robot moves in the ambience in the figure (Gazebo view):</p>
<p><img src="https://github.com/samuelepedrazzi/Assignment3_RT1/blob/noetic/images/Gazebo_map.png" alt="" width="600" height="350" class="inline"/></p>
<p>The robot knows only the portion of the surroundings that its sensors allow it to detect from its starting point because it does not know all of the map's boundaries.</p>
<p>The robot's map knowledge grows as it moves around the map. The robot's known surroundings is graphed and updated at each time instant on Rviz.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Rviz map not explored </th><th class="markdownTableHeadCenter">Rviz map explored  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><img src="https://github.com/samuelepedrazzi/Assignment3_RT1/blob/noetic/images/rviz_map.png" alt="" width="400" height="550" class="inline"/> </td><td class="markdownTableBodyCenter"><img src="https://github.com/samuelepedrazzi/Assignment3_RT1/blob/noetic/images/rviz_map_explored.png" alt="" width="400" height="550" class="inline"/>  </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md6"></a>
User-Interface &lt;img src="https://media4.giphy.com/media/o8QCgJacJR5balxq8Y/200w.webp?cid=ecf05e47v2cy2r25cqior5ftits1w4lipka50hjfqkj4jhz4&amp;rid=200w.webp&amp;ct=s" width="40"&gt;&lt;/h2&gt;</h2>
<p>This is the primary node, and it was the first to appear.</p>
<p>This node shows the user a little image that explains how to choose the robot's movement modes. It also manages user input by modifying the ros parameters that allow the activation of the nodes defined for each mode if the command is correct.</p>
<p>The following are some of the commands that can be used:</p>
<p><img src="https://github.com/samuelepedrazzi/Assignment3_RT1/blob/noetic/images/ui.png" alt="" width="450" height="450" class="inline"/></p>
<p>Depending on the user input it select the correct action to do, such as running one of the nodes,</p>
<div class="fragment"><div class="line">system(<span class="stringliteral">&quot;rosrun Assignment3_RT1 achieveGoalPosition&quot;</span>)</div>
</div><!-- fragment --><p>close the program (exiting from the main function) or reset the simulation with</p>
<p>``<code>cpp ros::service::call("/gazebo/reset_simulation", reset)</code> ```</p>
<p>For the nodes regarding the movement, which is a dynamic action, I choose to use a <b>non-blocking function</b> to get the user input, which is good for speeding up program execution and improving consumer experience (you don't have to press enter key every time). For the node concerning the setting and achievement of the preset coordinates I did not consider it necessary.</p>
<p>The repository I found on Github and changed a little bit for my purposes is from <code>kbNonBlock</code> at <a href="https://gist.github.com/whyrusleeping/3983293">teleop_twist_keyboard_repo</a>.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Achieve Goal Position node &lt;img src= "https://cdn-icons-png.flaticon.com/128/854/854894.png" width=40&gt;</h2>
<p>The first needed feature is implemented by the achieveGoalPosition node. In fact, it gives the robot a new goal based on the user's preferences. This node's goal is to drive the robot into the correct location in the environment once a position coordinates have been specified. At first the user is asked for the goal's x and y coordinates, after which the program generates and publishes a message of type <code>move_base_msgs/MoveBaseActionGoal</code> in the <code>/move_base/goal</code> topic. The node keeps track of each objective by assigning it an id that is generated at random within the node.</p>
<p>A <code>/move_base/status</code> message handler is used to determine whether the robot has reached the goal. It examines the messages that have been published on the previously indicated subject.</p>
<p>The initial status code is '<b>1</b>', which indicates that the robot is on his way and the goal is active. When the robot comes to a halt, the status code changes to '<b>3</b>' if the robot has reached the goal position, and to '<b>4</b>' if the robot is unable to reach the given location. Other statuses that have been managed are for instance the goal lost with status identifier '<b>5</b>' or the rejected status with the code '<b>9</b>'.</p>
<p>After having received the feedback of the status and the robot is stopped, so there isn't any active pending goal, the function <code>CancelGoal()</code>is called, a message of type <code>actionlib_msgs/GoalID</code> is generated and then published into the <code>/move_base/cancel</code> topic.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
User Drive Not Assisted node</h2>
<p>The user can control the robot movement with the keypad (remember to click on BLOC NUM, otherwise the correct ascii code will not be read):</p>
<center></center><center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter">Turn left </th><th class="markdownTableHeadCenter">Do not turn </th><th class="markdownTableHeadCenter">Turn right  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Go forward</b> </td><td class="markdownTableBodyCenter"><code>7</code> </td><td class="markdownTableBodyCenter"><code>8</code> </td><td class="markdownTableBodyCenter"><code>9</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><b>Stop</b> </td><td class="markdownTableBodyCenter"><code>4</code> </td><td class="markdownTableBodyCenter"><code>5</code> </td><td class="markdownTableBodyCenter"><code>6</code>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Go backward</b> </td><td class="markdownTableBodyCenter"><code>1</code> </td><td class="markdownTableBodyCenter"><code>2</code> </td><td class="markdownTableBodyCenter"><code>3</code>  </td></tr>
</table>
</center><center></center><p>The user can change the robot velocity of 10% by pressing the following keys:</p>
<center></center><center><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"></th><th class="markdownTableHeadCenter">Linear and Angular </th><th class="markdownTableHeadCenter">Linear only </th><th class="markdownTableHeadCenter">Angular only  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Increment</b> </td><td class="markdownTableBodyCenter"><code>*</code> </td><td class="markdownTableBodyCenter"><code>+</code> </td><td class="markdownTableBodyCenter"><code>a</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><b>Reset</b> </td><td class="markdownTableBodyCenter"><code>R or r</code> </td><td class="markdownTableBodyCenter"><code>e</code> </td><td class="markdownTableBodyCenter"><code>w</code>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><b>Decrease</b> </td><td class="markdownTableBodyCenter"><code>/</code> </td><td class="markdownTableBodyCenter"><code>-</code> </td><td class="markdownTableBodyCenter"><code>z</code>  </td></tr>
</table>
</center><center></center><p>The speed is calculated by multiplying the relative speed by the selected direction, which is an integer between -1 and 1. 1 indicates that the robot must go ahead or turn left, -1 indicates that the robot must move backward (or turn right), and 0 indicates that the robot must stop.</p>
<p>When the robot starts moving the move_base node publishes the right velocity and orientation on the cmd_vel topic.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
User Drive Assisted node &lt;img src= "https://media1.giphy.com/media/2Mn5rVOQSGnlRquUkM/200w.webp?cid=ecf05e47wixskor4jhxrjrz9it6ww1p8gd7giv8tq64fke67&amp;rid=200w.webp&amp;ct=s" width=100 height=60&gt;</h2>
<p>Essentially, it intends to allow the user to control the robot in the environment using the keyboard, but we also want to enable automatic obstacle avoidance in this instance.</p>
<p>The node, in particular, reads the same exact user inputs as the userDriveNotAssisted node with non-blocking getchar, but it also checks what the robot's laser scanner sees.</p>
<p>This is done&#160;by subscribing to the <code>/scan</code> topic and using the message it receives to detect walls that are too close to the robot. This topic is made up of 720 <em>ranges</em>, each of which contains all of the detected distances to the walls on its right, left and front.</p>
<p>Here below the code to select the right action to do in proximity of a wall:</p>
<div class="fragment"><div class="line"><span class="comment">// check if the distance of the robot to a wall is less than the threshold set before and update</span></div>
<div class="line"><span class="comment">// the speed in such a way that the robot cannot collide with circuit delimitations,</span></div>
<div class="line"><span class="comment">// it is able to continue driving avoiding walls.</span></div>
<div class="line"><span class="keywordflow">if</span> (front &lt; th_min)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (robot_vel.linear.x &gt; 0)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Stop the robot, it can only turn now</span></div>
<div class="line">            lin_dir = 0;</div>
<div class="line">            std::cout &lt;&lt; RED &lt;&lt; <span class="stringliteral">&quot;Be careful, wall on the front!\n&quot;</span></div>
<div class="line">                      &lt;&lt; NC;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line">    </div>
<div class="line"><span class="keywordflow">if</span> (right &lt; th_min)</div>
<div class="line">{   </div>
<div class="line">        <span class="keywordflow">if</span> (robot_vel.angular.z &lt; 0)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Stop the twist, it can only go straight now</span></div>
<div class="line">            angle_dir = 0;</div>
<div class="line">            std::cout &lt;&lt; RED &lt;&lt; <span class="stringliteral">&quot;Be careful, wall on the right!\n&quot;</span></div>
<div class="line">                      &lt;&lt; NC;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line">    </div>
<div class="line"><span class="keywordflow">if</span> (left &lt; th_min)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (robot_vel.angular.z &gt; 0)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Stop the twist, it can only go straight now</span></div>
<div class="line">            angle_dir = 0;</div>
<div class="line">            std::cout &lt;&lt; RED &lt;&lt; <span class="stringliteral">&quot;Be careful, wall on the left!\n&quot;</span></div>
<div class="line">                      &lt;&lt; NC;</div>
<div class="line">        }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The code examines the minimum distance between two points within these ranges, and if a wall is closer than <code>th_min= 1</code>, the robot is prevented from approaching it. The robot cannot progress if the front wall is too close, and the robot cannot turn in that direction if one of the barriers on the left or right is too close.</p>
<p>The functions merely edit the linear and angular direction according to the requirements above, setting them to '<b>0</b>' when required, to activate this security feature.</p>
<p>Finally, the user is prompted with a red risk warning text.</p>
<p><img src="https://media1.giphy.com/media/HGn4DKP2K6HLMTtzf9/200w.webp?cid=ecf05e47d9q1lels5jeofny61n0cbjmyhpl0zas1si8bxxbo&amp;rid=200w.webp&amp;ct=s" alt="" width="100" height="60" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
